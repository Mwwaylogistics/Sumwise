<section id="audio-tools">
  <h2>Try It Now</h2>

  <!-- File upload -->
  <label><strong>Upload Audio</strong></label><br />
  <input type="file" id="audioUpload" accept="audio/*" />
  <br><br>

  <!-- Audio recording -->
  <button id="startRecord">ğŸ™ï¸ Start Recording</button>
  <button id="stopRecord" disabled>â¹ Stop</button>

  <!-- Output -->
  <p id="status"></p>
  <pre id="summaryBox" style="white-space:pre-wrap;"></pre>
</section>

<script>
  const startBtn = document.getElementById("startRecord");
  const stopBtn = document.getElementById("stopRecord");
  const audioUpload = document.getElementById("audioUpload");
  const status = document.getElementById("status");
  const summaryBox = document.getElementById("summaryBox");

  let mediaRecorder;
  let audioChunks = [];

  // Upload file logic
  audioUpload.addEventListener("change", async (e) => {
    const file = e.target.files[0];
    if (!file) return;

    status.textContent = "Processing upload...";
    const formData = new FormData();
    formData.append("audio", file);

    const res = await fetch("/api/summarize", {
      method: "POST",
      body: formData,
    });

    const data = await res.json();
    summaryBox.textContent = data.summary || "No summary generated.";
    status.textContent = "Done.";
  });

  // Recording logic
  startBtn.onclick = async () => {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream);
    audioChunks = [];

    mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
    mediaRecorder.onstop = async () => {
      const blob = new Blob(audioChunks, { type: 'audio/webm' });
      const formData = new FormData();
      formData.append("audio", blob, "recording.webm");

      status.textContent = "Processing recording...";
      const res = await fetch("/api/summarize", {
        method: "POST",
        body: formData,
      });

      const data = await res.json();
      summaryBox.textContent = data.summary || "No summary generated.";
      status.textContent = "Done.";
    };

    mediaRecorder.start();
    startBtn.disabled = true;
    stopBtn.disabled = false;
  };

  stopBtn.onclick = () => {
    mediaRecorder.stop();
    startBtn.disabled = false;
    stopBtn.disabled = true;
  };
</script>
